<!DOCTYPE html>
<html>
  <head>
    <title>HAR to ZIP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" crossorigin="anonymous" integrity="b5d02b3f0bf3ae026451909419df07bb" type="text/javascript"></script>
  </head>
  <body>
    <input type="file" accept=".har"></input>
    <script>
      document.querySelector("input").onchange = function() {
        var file = document.querySelector('input[type="file"]').files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
          var har = JSON.parse(reader.result);
            var zip = new JSZip();
            har.log.entries.forEach(e => {
                var url = new URL(e.request.url,"https://www.example.com/")
                if (!["https:","http:","file:"].includes(url.protocol)) return
                var name = url.hostname + url.pathname
                if (url.protocol == "file:") name = name[1]+name.slice(3);
                var data = e.response?.content?.text;
                if (!data) return
                if (e.response.content.encoding == "base64") data = base64toUint8(data)
                zip.file(name,data,{date: new Date(e.startedDateTime)})
            });
            var curFile = "";
            zip.generateAsync({type:"blob"}, function updateCallback(metadata) {
                if (metadata.currentFile != curFile) {
                    console.log("Saving file: " + metadata.currentFile + " (" + metadata.percent.toFixed(2) + "%)");
                    curFile = metadata.currentFile;
                }
            }).then(blob => URL.createObjectURL(blob)).then(blobUrl => {
                var link = document.createElement("a");
                link.href = blobUrl;
                link.download = file.name.replace(/\.har$/,"") + ".zip";
                link.innerText = "Click here to download the file";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(blobUrl);
            });
        };
        reader.readAsText(file);
      }
      function base64toUint8(data) {
          data = atob(data)
          var n = data.length;
          var response = new Uint8Array(n);
          while(n--){
              response[n] = encoded.charCodeAt(n);
          }
          return response
      }
    </script>
  </body>
</html>
